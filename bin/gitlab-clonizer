#!/usr/bin/env bash

IFS=':' read -ra directories <<<"$SESH_DIRECTORIES"

repo=$(
  glab repo list -F json |
    jq -r .[].path_with_namespace |
    gum filter \
      --limit 1 \
      --no-sort \
      --fuzzy \
      --placeholder 'Pick a repo' \
      --height 50 \
      --prompt='ðŸ”'
)

base_folder=$(printf '%s\n' "${directories[@]}" | gum choose --limit 1)
repo_folder="$base_folder/$(basename "$repo")"

if [ -d "$repo_folder" ]; then
  . sesh-sessionizer "$repo_folder"
fi

echo "$repo_folder"
glab repo clone "$repo" "$repo_folder"
. sesh-sessionizer "$repo_folder"
