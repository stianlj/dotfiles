#!/usr/bin/env bash

directories=(~/Code/projects ~/Code/configuration ~/Code/homelab ~/Code/scripts)

if [ "$1" != "" ]; then
  session=$1
else
  all_dirs=$(
    find "${directories[@]}" -mindepth 1 -maxdepth 1 -not -path '*/.*' \
      -type d,l | sed 's/^/ğŸ“ /'
  )

  active_sessions=$(sesh list -t -i)

  session=$(
    printf "%s\n%s\n" "$active_sessions" "$all_dirs" | gum filter \
      --limit 1 \
      --no-sort \
      --fuzzy \
      --placeholder 'Pick a sesh or dir' \
      --height 50 \
      --prompt='âš¡'
  )
fi

is_kitty() {
  [[ "$TERM" == "xterm-kitty" ]]
}

session="${session#ğŸ“ }"
session_name=$(basename "$session")

if ! sesh list -t | grep "$session_name"; then
  echo "did not find session"
  is_kitty && kitten @ set-spacing padding=0
  sesh connect "$session"
  is_kitty && kitten @ set-spacing padding=default
else
  is_kitty && kitten @ set-spacing padding=0
  sesh connect "$session_name"
  is_kitty && kitten @ set-spacing padding=default
fi
