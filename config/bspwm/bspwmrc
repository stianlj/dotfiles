#!/bin/dash

if [ $COMPUTER_IDENTIFIER = "main-desktop" ]; then
  xrandr \
    --output DisplayPort-0 --auto --primary --pos 0x2160 \
    --output DisplayPort-1 --auto --pos 640x0

  bspc monitor DisplayPort\-1 -d 1 2
  bspc monitor DisplayPort\-0 -d 3 4 5 6 7 8 9 10
fi

if [ $COMPUTER_IDENTIFIER = "work-laptop" ]; then
  numberOfMonitorsConnected=$(xrandr -d :0 -q | grep ' connected' | wc -l)

  if [ "$numberOfMonitorsConnected" -gt "2" ]; then

    # export LEFT_MONITOR="eDP1"
    # export CENTER_MONITOR="HDMI-1-3"
    # export RIGHT_MONITOR="DP-1-3"
    # export CENTER_POLYBAR_BOTTOM="true"
    #
    # bspc monitor eDP1 -d 1 2 3
    # bspc monitor HDMI\-1\-3 -d 4 5 6 7
    # bspc monitor DP\-1\-3 -d 8 9 10
    # export LEFT_MONITOR="eDP1"
    # export CENTER_MONITOR="DP1-3"
    # export RIGHT_MONITOR="DP1-1"
    export LEFT_MONITOR="DP-1-1-1"
    export CENTER_MONITOR="DP-1-1-3"
    export RIGHT_MONITOR="eDP-1-1"
    export CENTER_POLYBAR_BOTTOM="true"
    export EMACS_FONT_SIZE="20"

    # bspc monitor eDP1 -d 1 2 3
    # bspc monitor DP1\-3 -d 4 5 6 7
    # bspc monitor DP1\-1 -d 8 9 10
    bspc monitor DP\-1\-1\-1 -d 1 2 3 4
    bspc monitor DP\-1\-1\-3 -d 5 6 7 8 9
    bspc monitor eDP\-1\-1 -d 10

    polybar middle-$COMPUTER_IDENTIFIER &
    polybar left &
    polybar right &
  elif [ "$numberOfMonitorsConnected" -gt "1" ]; then
    export RIGHT_MONITOR="eDP-1-1"
    export CENTER_MONITOR="DP-1-1-3"
    export CENTER_POLYBAR_BOTTOM="true"

    bspc monitor DP\-1\-1\-3 -d 1 2 3 4 5 6 7 8 9
    bspc monitor eDP\-1\-1 -d 10

    polybar middle-$COMPUTER_IDENTIFIER &
    polybar right &
  else
    # This should include more. Maybe in sync with udev?
    export CENTER_MONITOR="eDP-1-1"
    bspc monitor -d 1 2 3 4 5 6 7 8 9 10
    polybar middle-$COMPUTER_IDENTIFIER-hidpi &
    export EMACS_FONT_SIZE="28"
  fi
fi

# bspc config border_width 15
bspc config window_gap 15

bspc config split_ratio 0.5
bspc config borderless_monocle true
bspc config gapless_monocle true
bspc config single_monocle true
bspc config focus_follows_pointer true
bspc config pointer_follows_monitor true
bspc config pointer_follows_focus true
# bspc config normal_border_color \#2e3440
# bspc config active_border_color \#2e3440
# bspc config focused_border_color \#2e3440

bspc config external_rules_command ~/.config/bspwm/external_rules
bspc rule -a mpv state=floating border=off
bspc rule -a MPlayer state=floating border=off
bspc rule -a qutebrowser border=off
bspc rule -a Blueman-manager state=floating
bspc rule -a Alacritty border=off
bspc rule -a st border=off
bspc rule -a jetbrains-idea border=off
bspc rule -a Surf state=tiled
bspc rule -a Emacs state=tiled border=off

# autostart
setxkbmap -option compose:ralt
setxkbmap -option caps:escape
# compton -b --config="$HOME/.config/compton/compton.conf"
picom --experimental-backends -b
# deadd-notification-center &
xscreensaver &
clipit &
pasystray &
# megasync &
# blueman-applet &
# redshift-gtk -l $LAT_LON &

if [ $COMPUTER_IDENTIFIER = "main-desktop" ]; then
  # dropbox &
  megasync &
  nextcloud --background &
  $HOME/.config/polybar/launch.sh
  indicator-kdeconnect &
fi

if [ $COMPUTER_IDENTIFIER = "work-laptop" ]; then
  # conky -c ~/.config/conky/conky.conf &
  nm-applet &
  # systemctl --user start mopidy
  # hamster &
fi

feh --bg-fill $WALLPAPER
